<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Test262 Runner</title>
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<style>
body{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;margin:0;padding:16px}
h1{margin:0 0 16px 0}
.stats{display:flex;gap:16px;flex-wrap:wrap;margin-bottom:16px}
.stat{padding:8px 12px;border-radius:4px;background:#f5f5f5}
.layout{display:flex;gap:16px;align-items:flex-start}
#chart{width:600px;height:400px}
.running{flex:1;max-height:400px;overflow:auto;border:1px solid #eee;border-radius:4px;padding:8px}
.running-item{padding:4px 0;border-bottom:1px solid #f0f0f0;font-size:13px}
</style>
</head>
<body>
<div id="app">
<h1>Test262 Runner</h1>
<div class="stats">
<div class="stat">Total: {{ status.total }}</div>
<div class="stat">Completed: {{ status.completed }}</div>
<div class="stat">Passed: {{ status.passed }}</div>
<div class="stat">Failed: {{ status.failed }}</div>
<div class="stat">Timed out: {{ status.timedOut }}</div>
<div class="stat">Running: {{ status.running.length }}</div>
<div class="stat">Remaining: {{ status.remaining }}</div>
<div class="stat">Workers: {{ status.workers }}</div>
</div>
<div class="layout">
<div id="chart"></div>
<div class="running">
<div class="running-item" v-for="item in status.running" :key="item.workerId + '-' + item.test">
<strong>{{ item.test }}</strong>
<span> worker {{ item.workerId }}, {{ Math.round(item.elapsedMs / 1000) }}s</span>
</div>
<div v-if="status.running.length === 0">No tests running</div>
</div>
</div>
</div>
<script>
const { createApp, onMounted, ref } = Vue
createApp({
  setup() {
    const status = ref({
      total: 0,
      completed: 0,
      passed: 0,
      failed: 0,
      timedOut: 0,
      running: [],
      remaining: 0,
      workers: 0
    })
    let chart = null
    async function fetchStatus() {
      try {
        const res = await fetch("/status")
        if (!res.ok) return
        const data = await res.json()
        status.value = data
        if (chart) {
          const remaining = data.remaining < 0 ? 0 : data.remaining
          chart.setOption({
            series: [{
              type: "pie",
              radius: "70%",
              label: {
                formatter: "{b}: {d}%"
              },
              data: [
                { value: data.passed, name: "Passed" },
                { value: data.failed, name: "Failed" },
                { value: data.timedOut, name: "Timed out" },
                { value: remaining, name: "Remaining" }
              ]
            }]
          })
        }
      } catch (e) {}
    }
    onMounted(() => {
      chart = echarts.init(document.getElementById("chart"))
      chart.setOption({
        title: { text: "Test262 Progress" },
        tooltip: { trigger: "item" },
        legend: { orient: "vertical", left: "right" },
        color: ["#4caf50", "#f44336", "#ff9800", "#9e9e9e"],
        series: [{
          type: "pie",
          radius: "70%",
          label: {
            formatter: "{b}: {d}%"
          },
          data: []
        }]
      })
      fetchStatus()
      setInterval(fetchStatus, 1000)
    })
    return { status }
  }
}).mount("#app")
</script>
</body>
</html>
